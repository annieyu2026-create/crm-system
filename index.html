```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户管理系统</title>
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.6.0/echarts.min.js"></script>
    <style>
        * {
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .status-badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .sidebar-link {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        .sidebar-link:hover::before,
        .sidebar-link.active::before {
            transform: scaleY(1);
        }
        
        .sidebar-link.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            animation: slideUp 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-input {
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .table-row {
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.01);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 登录/注册页面 -->
    <div id="auth-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="glass-effect rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto rounded-2xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center mb-4">
                    <i class="fas fa-users text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">客户管理系统</h1>
                <p class="text-gray-500">CRM System</p>
            </div>
            
            <!-- 登录表单 -->
            <div id="login-form-container">
                <h2 class="text-xl font-bold text-gray-800 mb-6">登录账号</h2>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">邮箱账号</label>
                        <input type="email" id="login-email" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="请输入企业邮箱 @fengfancloud.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">密码</label>
                        <input type="password" id="login-password" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="请输入密码">
                    </div>
                    <button type="submit" class="w-full btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        登录
                    </button>
                </form>
                <p class="text-center text-gray-500 text-sm mt-4">
                    还没有账号？<a href="#" id="show-register" class="text-purple-600 hover:text-purple-700 font-medium">立即注册</a>
                </p>
            </div>
            
            <!-- 注册表单 -->
            <div id="register-form-container" class="hidden">
                <h2 class="text-xl font-bold text-gray-800 mb-6">注册账号</h2>
                <form id="register-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">姓名</label>
                        <input type="text" id="register-name" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="请输入姓名">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">邮箱账号</label>
                        <input type="email" id="register-email" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="请输入企业邮箱 @fengfancloud.com">
                        <p class="text-xs text-gray-500 mt-1">仅支持公司企业邮箱注册</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">密码</label>
                        <input type="password" id="register-password" required minlength="6"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="至少6位密码">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">确认密码</label>
                        <input type="password" id="register-password-confirm" required minlength="6"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="请再次输入密码">
                    </div>
                    <button type="submit" class="w-full btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        注册
                    </button>
                </form>
                <p class="text-center text-gray-500 text-sm mt-4">
                    已有账号？<a href="#" id="show-login" class="text-purple-600 hover:text-purple-700 font-medium">立即登录</a>
                </p>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div id="main-app" class="hidden flex h-screen overflow-hidden">
        <!-- 侧边栏 -->
        <div class="w-64 bg-white shadow-xl z-10 flex flex-col">
            <div class="p-6 flex items-center space-x-3 border-b border-gray-100">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center">
                    <i class="fas fa-users text-white"></i>
                </div>
                <span class="text-xl font-bold text-gray-800">CRM系统</span>
            </div>
            
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center space-x-3 mb-2">
                    <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-bold" id="user-avatar">
                        <!-- 用户头像 -->
                    </div>
                    <div>
                        <p class="font-bold text-gray-800" id="user-name">用户</p>
                        <p class="text-xs text-gray-500" id="user-role">管理员</p>
                    </div>
                </div>
            </div>
            
            <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                <a href="#" class="sidebar-link active flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl hover:bg-gray-50" data-page="dashboard">
                    <i class="fas fa-chart-line w-6"></i>
                    <span>仪表盘</span>
                </a>
                <a href="#" class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl hover:bg-gray-50" data-page="customers">
                    <i class="fas fa-address-book w-6"></i>
                    <span>客户列表</span>
                </a>
                <a href="#" class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl hover:bg-gray-50" data-page="opportunities">
                    <i class="fas fa-hand-holding-usd w-6"></i>
                    <span>商机管理</span>
                </a>
                <a href="#" class="sidebar-link flex items-center space-x-3 px-4 py-3 text-gray-600 rounded-xl hover:bg-gray-50" data-page="interactions">
                    <i class="fas fa-comments w-6"></i>
                    <span>跟进记录</span>
                </a>
            </nav>
            
            <div class="p-4 border-t border-gray-100">
                <button id="logout-btn" class="w-full flex items-center justify-center space-x-2 px-4 py-3 text-red-500 hover:bg-red-50 rounded-xl transition-colors">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>退出登录</span>
                </button>
            </div>
        </div>

        <!-- 内容区域 -->
        <div class="flex-1 overflow-y-auto bg-gray-50 p-8" id="content-area">
            <!-- 仪表盘 -->
            <div id="page-dashboard" class="space-y-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">仪表盘</h2>
                        <p class="text-gray-500">查看业务概览和统计数据</p>
                    </div>
                    <div class="text-sm text-gray-500" id="current-date">
                        <!-- 当前日期 -->
                    </div>
                </div>
                
                <!-- 统计卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="glass-effect p-6 rounded-2xl card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-blue-100 rounded-xl text-blue-600">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                            <span class="text-green-500 text-sm font-medium flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i> +12%
                            </span>
                        </div>
                        <h3 class="text-gray-500 text-sm font-medium">总客户数</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-total-customers">0</p>
                    </div>
                    
                    <div class="glass-effect p-6 rounded-2xl card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-purple-100 rounded-xl text-purple-600">
                                <i class="fas fa-hand-holding-usd text-xl"></i>
                            </div>
                            <span class="text-green-500 text-sm font-medium flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i> +8%
                            </span>
                        </div>
                        <h3 class="text-gray-500 text-sm font-medium">本月商机</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-monthly-opportunities">0</p>
                    </div>
                    
                    <div class="glass-effect p-6 rounded-2xl card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-green-100 rounded-xl text-green-600">
                                <i class="fas fa-check-circle text-xl"></i>
                            </div>
                            <span class="text-green-500 text-sm font-medium flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i> +5%
                            </span>
                        </div>
                        <h3 class="text-gray-500 text-sm font-medium">成交率</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-conversion-rate">0%</p>
                    </div>
                    
                    <div class="glass-effect p-6 rounded-2xl card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div class="p-3 bg-orange-100 rounded-xl text-orange-600">
                                <i class="fas fa-yen-sign text-xl"></i>
                            </div>
                            <span class="text-green-500 text-sm font-medium flex items-center">
                                <i class="fas fa-arrow-up mr-1"></i> +15%
                            </span>
                        </div>
                        <h3 class="text-gray-500 text-sm font-medium">预计收入</h3>
                        <p class="text-3xl font-bold text-gray-800 mt-2" id="stat-expected-revenue">¥0</p>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-effect p-6 rounded-2xl">
                        <h3 class="text-lg font-bold text-gray-800 mb-6">客户增长趋势</h3>
                        <div id="chart-customer-growth" style="height: 300px;"></div>
                    </div>
                    <div class="glass-effect p-6 rounded-2xl">
                        <h3 class="text-lg font-bold text-gray-800 mb-6">商机漏斗</h3>
                        <div id="chart-opportunity-funnel" style="height: 300px;"></div>
                    </div>
                </div>
            </div>

            <!-- 客户列表 -->
            <div id="page-customers" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">客户列表</h2>
                        <p class="text-gray-500">管理所有客户信息</p>
                    </div>
                    <button id="add-customer-btn" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        <i class="fas fa-plus mr-2"></i>添加客户
                    </button>
                </div>

                <div class="glass-effect rounded-2xl overflow-hidden shadow-sm">
                    <div class="p-4 border-b border-gray-100">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="customer-search" placeholder="搜索客户姓名、公司或电话..." 
                                   class="search-input w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:border-purple-500">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-500 text-sm">
                                    <th class="p-4 font-medium">姓名</th>
                                    <th class="p-4 font-medium">公司</th>
                                    <th class="p-4 font-medium">联系方式</th>
                                    <th class="p-4 font-medium">级别</th>
                                    <th class="p-4 font-medium">状态</th>
                                    <th class="p-4 font-medium">操作</th>
                                </tr>
                            </thead>
                            <tbody id="customer-list" class="text-gray-700">
                                <!-- 客户列表内容由JS生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 商机管理 -->
            <div id="page-opportunities" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">商机管理</h2>
                        <p class="text-gray-500">跟踪和管理销售商机</p>
                    </div>
                    <button id="add-opportunity-btn" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        <i class="fas fa-plus mr-2"></i>添加商机
                    </button>
                </div>

                <div class="glass-effect rounded-2xl overflow-hidden shadow-sm">
                    <div class="p-4 border-b border-gray-100">
                        <div class="relative">
                            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" id="opportunity-search" placeholder="搜索商机..." 
                                   class="search-input w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:border-purple-500">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-50 text-gray-500 text-sm">
                                    <th class="p-4 font-medium">客户</th>
                                    <th class="p-4 font-medium">产品</th>
                                    <th class="p-4 font-medium">预计金额</th>
                                    <th class="p-4 font-medium">交付周期</th>
                                    <th class="p-4 font-medium">阶段</th>
                                    <th class="p-4 font-medium">操作</th>
                                </tr>
                            </thead>
                            <tbody id="opportunity-list" class="text-gray-700">
                                <!-- 商机列表内容由JS生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 跟进记录 -->
            <div id="page-interactions" class="hidden space-y-6">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">跟进记录</h2>
                        <p class="text-gray-500">记录与客户的每一次互动</p>
                    </div>
                    <button id="add-interaction-btn" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        <i class="fas fa-plus mr-2"></i>添加记录
                    </button>
                </div>

                <div class="glass-effect rounded-2xl p-6">
                    <div class="space-y-6" id="interaction-list">
                        <!-- 跟进记录内容由JS生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑客户模态框 -->
    <div id="customer-modal" class="modal">
        <div class="modal-content glass-effect rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="customer-modal-title">添加客户</h3>
                <button class="close-modal text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="customer-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">姓名 *</label>
                        <input type="text" id="customer-name" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">公司名称 *</label>
                        <input type="text" id="customer-company" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">职位</label>
                        <input type="text" id="customer-position" 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">电话 *</label>
                        <input type="tel" id="customer-phone" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">邮箱</label>
                    <input type="email" id="customer-email" 
                           class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">客户级别</label>
                        <select id="customer-level" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                            <option value="A">A类 (重点)</option>
                            <option value="B">B类 (普通)</option>
                            <option value="C">C类 (潜在)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">状态</label>
                        <select id="customer-status" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                            <option value="active">跟进中</option>
                            <option value="completed">已成交</option>
                            <option value="inactive">已流失</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">备注</label>
                    <textarea id="customer-notes" rows="3" 
                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" class="close-modal px-6 py-3 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 font-medium">
                        取消
                    </button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 添加/编辑商机模态框 -->
    <div id="opportunity-modal" class="modal">
        <div class="modal-content glass-effect rounded-2xl p-8 max-w-3xl w-full mx-4 shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800" id="opportunity-modal-title">添加商机</h3>
                <button class="close-modal text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="opportunity-form" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">客户姓名 *</label>
                        <input type="text" id="opportunity-customer-name" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">公司名称 *</label>
                        <input type="text" id="opportunity-company" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">联系邮箱 *</label>
                        <input type="email" id="opportunity-email" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">联系电话 *</label>
                        <input type="tel" id="opportunity-phone" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">产品名称 *</label>
                        <input type="text" id="opportunity-product" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="例如：企业管理软件">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">产品报价 (元) *</label>
                        <input type="number" id="opportunity-original-price" required min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="0.00">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">折扣 (%)</label>
                        <input type="number" id="opportunity-discount" min="0" max="100" step="0.1"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="例如：10 表示9折"
                               value="0">
                        <p class="text-xs text-gray-500 mt-1">0表示无折扣，10表示9折，20表示8折</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">合同金额 (元) *</label>
                        <input type="number" id="opportunity-amount" required min="0" step="0.01"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 bg-gray-50"
                               placeholder="0.00" readonly>
                        <p class="text-xs text-gray-500 mt-1">根据报价和折扣自动计算</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">交付周期 (天) *</label>
                        <input type="number" id="opportunity-delivery-period" required min="1"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="例如：30">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">回款周期 (天) *</label>
                        <input type="number" id="opportunity-payment-period" required min="1"
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                               placeholder="例如：60">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">是否已交付</label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery-status" value="false" checked
                                   class="w-4 h-4 text-purple-600 focus:ring-purple-500">
                            <span class="ml-2 text-gray-700">未交付</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery-status" value="true"
                                   class="w-4 h-4 text-purple-600 focus:ring-purple-500">
                            <span class="ml-2 text-gray-700">已交付</span>
                        </label>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">备注</label>
                    <textarea id="opportunity-notes" rows="3" 
                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" class="close-modal px-6 py-3 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 font-medium">
                        取消
                    </button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加跟进记录模态框 -->
    <div id="interaction-modal" class="modal">
        <div class="modal-content glass-effect rounded-2xl p-8 max-w-2xl w-full mx-4 shadow-2xl">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-gray-800">添加跟进记录</h3>
                <button class="close-modal text-gray-400 hover:text-gray-600 text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="interaction-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">选择客户 *</label>
                    <select id="interaction-customer" required 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                        <!-- 客户选项由JS生成 -->
                    </select>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">跟进方式 *</label>
                        <select id="interaction-type" required 
                                class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                            <option value="phone">电话</option>
                            <option value="email">邮件</option>
                            <option value="meeting">面谈</option>
                            <option value="wechat">微信</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">日期 *</label>
                        <input type="date" id="interaction-date" required 
                               class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">跟进内容 *</label>
                    <textarea id="interaction-content" required rows="4" 
                              class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:border-purple-500"
                              placeholder="记录跟进的详细情况..."></textarea>
                </div>
                
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" class="close-modal px-6 py-3 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 font-medium">
                        取消
                    </button>
                    <button type="submit" class="btn-primary text-white px-6 py-3 rounded-xl font-medium shadow-lg">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 配置常量
        const COMPANY_EMAIL_DOMAIN = '@fengfancloud.com'; // 企业邮箱域名
        const ADMIN_EMAIL = 'admin' + COMPANY_EMAIL_DOMAIN; // 默认管理员邮箱

        // 数据存储
        let users = JSON.parse(localStorage.getItem('crm_users')) || [
            { name: '管理员', email: ADMIN_EMAIL, password: 'admin', role: 'admin' }
        ];
        
        let currentUser = JSON.parse(localStorage.getItem('crm_current_user')) || null;
        
        // 模拟数据
        let customers = JSON.parse(localStorage.getItem('crm_customers')) || [
            { id: 1, name: '张三', company: '科技有限公司', position: 'CTO', phone: '13800138000', email: 'zhangsan@tech.com', level: 'A', status: 'active', notes: '对云服务感兴趣', createdBy: ADMIN_EMAIL, createdAt: '2025-01-15' },
            { id: 2, name: '李四', company: '贸易有限公司', position: '采购经理', phone: '13900139000', email: 'lisi@trade.com', level: 'B', status: 'active', notes: '需要进销存系统', createdBy: ADMIN_EMAIL, createdAt: '2025-02-10' },
            { id: 3, name: '王五', company: '教育机构', position: '校长', phone: '13700137000', email: 'wangwu@edu.com', level: 'C', status: 'inactive', notes: '暂时没有预算', createdBy: ADMIN_EMAIL, createdAt: '2024-12-20' }
        ];
        
        let opportunities = JSON.parse(localStorage.getItem('crm_opportunities')) || [
            { 
                id: 1, 
                customerId: 1, 
                customerName: '张三', 
                company: '科技有限公司',
                email: 'zhangsan@tech.com',
                phone: '13800138000',
                product: '企业云服务专业版', 
                amount: 50000, 
                originalPrice: 50000,
                discount: 0,
                deliveryPeriod: 30,
                paymentPeriod: 60,
                stage: 'negotiation', 
                isDelivered: false,
                isPaid: false,
                notes: '正在商谈合同细节',
                createdAt: '2025-02-01' 
            },
            { 
                id: 2, 
                customerId: 2, 
                customerName: '李四', 
                company: '贸易有限公司',
                email: 'lisi@trade.com',
                phone: '13900139000',
                product: '进销存管理系统', 
                amount: 28000, 
                originalPrice: 30000,
                discount: 6.7, // 约9.3折
                deliveryPeriod: 15,
                paymentPeriod: 30,
                stage: 'proposal', 
                isDelivered: false,
                isPaid: false,
                notes: '已发送报价方案',
                createdAt: '2025-02-12' 
            }
        ];
        
        let interactions = JSON.parse(localStorage.getItem('crm_interactions')) || [
            { id: 1, customerId: 1, customerName: '张三', type: 'phone', date: '2025-02-01', content: '电话沟通需求，客户对云服务感兴趣', createdBy: ADMIN_EMAIL },
            { id: 2, customerId: 1, customerName: '张三', type: 'meeting', date: '2025-02-05', content: '上门拜访演示系统', createdBy: ADMIN_EMAIL },
            { id: 3, customerId: 2, customerName: '李四', type: 'wechat', date: '2025-02-12', content: '发送产品介绍资料', createdBy: ADMIN_EMAIL }
        ];

        // 当前编辑ID
        let currentEditId = null;
        let currentEditType = null; // 'customer' or 'opportunity'

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            initNavigation();
            initModals();
            initForms();
            initCharts();
            checkLoginStatus();
            
            // 设置日期输入框默认值为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('interaction-date').value = today;
            
            // 显示当前日期
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('zh-CN', dateOptions);

            // 监听价格和折扣变化，自动计算金额
            const priceInput = document.getElementById('opportunity-original-price');
            const discountInput = document.getElementById('opportunity-discount');
            
            if (priceInput && discountInput) {
                [priceInput, discountInput].forEach(input => {
                    input.addEventListener('input', calculateAmount);
                });
            }
        });

        // 自动计算合同金额
        function calculateAmount() {
            const price = parseFloat(document.getElementById('opportunity-original-price').value) || 0;
            const discount = parseFloat(document.getElementById('opportunity-discount').value) || 0;
            const amountInput = document.getElementById('opportunity-amount');
            
            if (price >= 0) {
                let finalAmount = price;
                if (discount > 0 && discount <= 100) {
                    // 折扣计算：例如10表示9折，即减去10%
                    finalAmount = price * (1 - discount / 100);
                }
                amountInput.value = finalAmount.toFixed(2);
            }
        }

        // 权限验证
        function initAuth() {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const showRegisterBtn = document.getElementById('show-register');
            const showLoginBtn = document.getElementById('show-login');
            const logoutBtn = document.getElementById('logout-btn');

            // 切换到注册
            showRegisterBtn.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-form-container').classList.add('hidden');
                document.getElementById('register-form-container').classList.remove('hidden');
            });

            // 切换到登录
            showLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('register-form-container').classList.add('hidden');
                document.getElementById('login-form-container').classList.remove('hidden');
            });

            // 登录处理
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;

                // 验证邮箱域名
                if (!email.endsWith(COMPANY_EMAIL_DOMAIN)) {
                    alert(`请使用公司企业邮箱 (${COMPANY_EMAIL_DOMAIN}) 登录`);
                    return;
                }

                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    login(user);
                } else {
                    alert('账号或密码错误');
                }
            });

            // 注册处理
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-password-confirm').value;

                // 验证邮箱域名
                if (!email.endsWith(COMPANY_EMAIL_DOMAIN)) {
                    alert(`请使用公司企业邮箱 (${COMPANY_EMAIL_DOMAIN}) 注册`);
                    return;
                }

                if (password !== confirmPassword) {
                    alert('两次输入的密码不一致');
                    return;
                }

                if (users.some(u => u.email === email)) {
                    alert('该邮箱已被注册');
                    return;
                }

                const newUser = {
                    name,
                    email,
                    password,
                    role: 'user'
                };

                users.push(newUser);
                localStorage.setItem('crm_users', JSON.stringify(users));
                
                alert('注册成功，请登录');
                showLoginBtn.click();
            });

            // 退出登录
            logoutBtn.addEventListener('click', () => {
                currentUser = null;
                localStorage.removeItem('crm_current_user');
                checkLoginStatus();
            });
        }

        function login(user) {
            currentUser = user;
            localStorage.setItem('crm_current_user', JSON.stringify(user));
            checkLoginStatus();
        }

        function checkLoginStatus() {
            const authPage = document.getElementById('auth-page');
            const mainApp = document.getElementById('main-app');
            const userNameDisplay = document.getElementById('user-name');
            const userRoleDisplay = document.getElementById('user-role');
            const userAvatar = document.getElementById('user-avatar');

            if (currentUser) {
                authPage.classList.add('hidden');
                mainApp.classList.remove('hidden');
                mainApp.classList.add('flex'); // 确保flex布局生效
                
                userNameDisplay.textContent = currentUser.name;
                userRoleDisplay.textContent = currentUser.role === 'admin' ? '管理员' : '普通用户';
                userAvatar.textContent = currentUser.name.charAt(0);
                
                // 加载数据
                renderDashboard();
                renderCustomers();
                renderOpportunities();
                renderInteractions();
            } else {
                authPage.classList.remove('hidden');
                mainApp.classList.add('hidden');
                mainApp.classList.remove('flex');
            }
        }

        // 导航处理
        function initNavigation() {
            const links = document.querySelectorAll('.sidebar-link');
            const pages = document.querySelectorAll('[id^="page-"]');

            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // 更新链接状态
                    links.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    
                    // 切换页面
                    const pageId = `page-${link.dataset.page}`;
                    pages.forEach(page => {
                        if (page.id === pageId) {
                            page.classList.remove('hidden');
                            // 如果是仪表盘，重新调整图表大小
                            if (pageId === 'page-dashboard') {
                                setTimeout(() => {
                                    echarts.getInstanceByDom(document.getElementById('chart-customer-growth'))?.resize();
                                    echarts.getInstanceByDom(document.getElementById('chart-opportunity-funnel'))?.resize();
                                }, 100);
                            }
                        } else {
                            page.classList.add('hidden');
                        }
                    });
                });
            });
        }

        // 模态框处理
        function initModals() {
            const modals = document.querySelectorAll('.modal');
            const closeButtons = document.querySelectorAll('.close-modal');
            
            // 按钮触发
            const addCustomerBtn = document.getElementById('add-customer-btn');
            const addOpportunityBtn = document.getElementById('add-opportunity-btn');
            const addInteractionBtn = document.getElementById('add-interaction-btn');
            
            const customerModal = document.getElementById('customer-modal');
            const opportunityModal = document.getElementById('opportunity-modal');
            const interactionModal = document.getElementById('interaction-modal');

            // 关闭模态框
            closeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    modals.forEach(m => m.classList.remove('active'));
                });
            });

            // 点击外部关闭
            modals.forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // 添加客户按钮点击事件
            addCustomerBtn.addEventListener('click', () => {
                currentEditId = null;
                currentEditType = 'customer';
                document.getElementById('customer-modal-title').textContent = '添加客户';
                document.getElementById('customer-form').reset();
                customerModal.classList.add('active');
            });

            // 添加互动记录按钮点击事件
            addInteractionBtn.addEventListener('click', () => {
                // 填充客户选项
                const select = document.getElementById('interaction-customer');
                select.innerHTML = '';
                customers.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.id;
                    option.textContent = c.name;
                    select.appendChild(option);
                });
                
                document.getElementById('interaction-form').reset();
                // 恢复默认日期
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('interaction-date').value = today;
                
                interactionModal.classList.add('active');
            });

            // 添加商机按钮点击事件
            addOpportunityBtn.addEventListener('click', () => {
                currentEditId = null;
                currentEditType = 'opportunity';
                document.getElementById('opportunity-modal-title').textContent = '添加商机';
                document.getElementById('opportunity-form').reset();
                opportunityModal.classList.add('active');
            });
        }

        // 表单处理
        function initForms() {
            // 客户表单
            document.getElementById('customer-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                
                const customerData = {
                    name: document.getElementById('customer-name').value,
                    company: document.getElementById('customer-company').value,
                    position: document.getElementById('customer-position').value,
                    phone: document.getElementById('customer-phone').value,
                    email: document.getElementById('customer-email').value,
                    level: document.getElementById('customer-level').value,
                    status: document.getElementById('customer-status').value,
                    notes: document.getElementById('customer-notes').value,
                };

                if (currentEditId && currentEditType === 'customer') {
                    // 编辑模式
                    const index = customers.findIndex(c => c.id === currentEditId);
                    if (index !== -1) {
                        customers[index] = { ...customers[index], ...customerData };
                    }
                } else {
                    // 新增模式
                    const newCustomer = {
                        id: Date.now(),
                        ...customerData,
                        createdBy: currentUser.email,
                        createdAt: new Date().toISOString().split('T')[0]
                    };
                    customers.push(newCustomer);
                }

                saveData();
                renderCustomers();
                renderDashboard();
                document.getElementById('customer-modal').classList.remove('active');
                form.reset();
                currentEditId = null;
                currentEditType = null;
            });

            // 商机表单
            document.getElementById('opportunity-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                
                // 获取交付状态
                const deliveryStatus = document.querySelector('input[name="delivery-status"]:checked').value === 'true';
                
                // 查找或创建关联客户
                // 简单起见，这里假设用户输入了客户信息，我们查找匹配的客户，如果没有则新建
                // 在实际系统中，这里应该是一个下拉选择框
                
                const customerName = document.getElementById('opportunity-customer-name').value;
                const companyName = document.getElementById('opportunity-company').value;
                
                let relatedCustomer = customers.find(c => c.name === customerName && c.company === companyName);
                
                if (!relatedCustomer) {
                    // 自动创建新客户
                    relatedCustomer = {
                        id: Date.now() + 1, // 确保ID不重复
                        name: customerName,
                        company: companyName,
                        phone: document.getElementById('opportunity-phone').value,
                        email: document.getElementById('opportunity-email').value,
                        level: 'B', // 默认B类
                        status: 'active',
                        notes: '由商机自动创建',
                        createdBy: currentUser.email,
                        createdAt: new Date().toISOString().split('T')[0]
                    };
                    customers.push(relatedCustomer);
                }
                
                const opportunityData = {
                    customerId: relatedCustomer.id,
                    customerName: customerName,
                    company: companyName,
                    phone: document.getElementById('opportunity-phone').value,
                    email: document.getElementById('opportunity-email').value,
                    product: document.getElementById('opportunity-product').value,
                    originalPrice: parseFloat(document.getElementById('opportunity-original-price').value),
                    discount: parseFloat(document.getElementById('opportunity-discount').value) || 0,
                    amount: parseFloat(document.getElementById('opportunity-amount').value),
                    deliveryPeriod: parseInt(document.getElementById('opportunity-delivery-period').value),
                    paymentPeriod: parseInt(document.getElementById('opportunity-payment-period').value),
                    isDelivered: deliveryStatus,
                    notes: document.getElementById('opportunity-notes').value,
                    stage: deliveryStatus ? 'closed' : 'negotiation' // 简单逻辑
                };

                if (currentEditId && currentEditType === 'opportunity') {
                    // 编辑模式
                    const index = opportunities.findIndex(o => o.id === currentEditId);
                    if (index !== -1) {
                        opportunities[index] = { ...opportunities[index], ...opportunityData };
                    }
                } else {
                    // 新增模式
                    const newOpportunity = {
                        id: Date.now(),
                        ...opportunityData,
                        createdAt: new Date().toISOString().split('T')[0]
                    };
                    opportunities.push(newOpportunity);
                }

                saveData();
                renderOpportunities();
                renderCustomers(); // 客户列表可能更新
                renderDashboard();
                updateOpportunityStats();
                document.getElementById('opportunity-modal').classList.remove('active');
                form.reset();
                currentEditId = null;
                currentEditType = null;
            });

            // 跟进记录表单
            document.getElementById('interaction-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const form = e.target;
                
                const customerId = parseInt(document.getElementById('interaction-customer').value);
                const customer = customers.find(c => c.id === customerId);
                
                const newInteraction = {
                    id: Date.now(),
                    customerId: customerId,
                    customerName: customer ? customer.name : '未知客户',
                    type: document.getElementById('interaction-type').value,
                    date: document.getElementById('interaction-date').value,
                    content: document.getElementById('interaction-content').value,
                    createdBy: currentUser.email
                };

                interactions.unshift(newInteraction); // 添加到开头
                saveData();
                renderInteractions();
                document.getElementById('interaction-modal').classList.remove('active');
                form.reset();
            });
        }

        // 数据持久化
        function saveData() {
            localStorage.setItem('crm_customers', JSON.stringify(customers));
            localStorage.setItem('crm_opportunities', JSON.stringify(opportunities));
            localStorage.setItem('crm_interactions', JSON.stringify(interactions));
        }

        // 渲染仪表盘
        function renderDashboard() {
            // 更新统计卡片
            document.getElementById('stat-total-customers').textContent = customers.length;
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            const monthlyOpps = opportunities.filter(o => o.createdAt.startsWith(currentMonth));
            document.getElementById('stat-monthly-opportunities').textContent = monthlyOpps.length;
            
            // 简单计算成交率
            const closedOpps = opportunities.filter(o => o.stage === 'closed' || o.isDelivered);
            const conversionRate = opportunities.length > 0 ? Math.round((closedOpps.length / opportunities.length) * 100) : 0;
            document.getElementById('stat-conversion-rate').textContent = conversionRate + '%';
            
            // 计算总金额
            const totalAmount = opportunities.reduce((sum, o) => sum + (parseFloat(o.amount) || 0), 0);
            document.getElementById('stat-expected-revenue').textContent = '¥' + totalAmount.toLocaleString();
        }

        // 初始化图表
        function initCharts() {
            // 客户增长图表
            const growthChart = echarts.init(document.getElementById('chart-customer-growth'));
            const growthOption = {
                tooltip: { trigger: 'axis' },
                grid: { top: 20, right: 20, bottom: 20, left: 40, containLabel: true },
                xAxis: { type: 'category', data: ['1月', '2月', '3月', '4月', '5月', '6月'] },
                yAxis: { type: 'value' },
                series: [{
                    data: [5, 12, 18, 25, 30, customers.length],
                    type: 'line',
                    smooth: true,
                    itemStyle: { color: '#764ba2' },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(118, 75, 162, 0.5)' },
                            { offset: 1, color: 'rgba(118, 75, 162, 0.0)' }
                        ])
                    }
                }]
            };
            growthChart.setOption(growthOption);

            // 商机漏斗图表
            const funnelChart = echarts.init(document.getElementById('chart-opportunity-funnel'));
            const funnelOption = {
                tooltip: { trigger: 'item', formatter: '{b} : {c}%' },
                series: [
                    {
                        name: '商机漏斗',
                        type: 'funnel',
                        left: '10%',
                        top: 60,
                        bottom: 60,
                        width: '80%',
                        min: 0,
                        max: 100,
                        minSize: '0%',
                        maxSize: '100%',
                        sort: 'descending',
                        gap: 2,
                        label: { show: true, position: 'inside' },
                        labelLine: { length: 10, lineStyle: { width: 1, type: 'solid' } },
                        itemStyle: { borderColor: '#fff', borderWidth: 1 },
                        emphasis: { label: { fontSize: 20 } },
                        data: [
                            { value: 100, name: '潜在客户' },
                            { value: 80, name: '初步沟通' },
                            { value: 60, name: '方案报价' },
                            { value: 40, name: '商务谈判' },
                            { value: 20, name: '赢单' }
                        ]
                    }
                ]
            };
            funnelChart.setOption(funnelOption);

            // 监听窗口大小变化
            window.addEventListener('resize', () => {
                growthChart.resize();
                funnelChart.resize();
            });
        }

        // 渲染客户列表
        function renderCustomers() {
            const list = document.getElementById('customer-list');
            list.innerHTML = '';
            
            customers.forEach(customer => {
                const tr = document.createElement('tr');
                tr.className = 'table-row border-b border-gray-100';
                
                let statusClass = customer.status === 'active' ? 'bg-green-100 text-green-600' : 
                                  (customer.status === 'completed' ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-600');
                
                let statusText = customer.status === 'active' ? '跟进中' : 
                                 (customer.status === 'completed' ? '已成交' : '已流失');
                
                tr.innerHTML = `
                    <td class="p-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xs">
                                ${customer.name.charAt(0)}
                            </div>
                            <span class="font-medium text-gray-800">${customer.name}</span>
                        </div>
                    </td>
                    <td class="p-4 text-gray-600">${customer.company}</td>
                    <td class="p-4">
                        <div class="text-sm">
                            <div class="text-gray-800">${customer.phone}</div>
                            <div class="text-gray-400 text-xs">${customer.email || '-'}</div>
                        </div>
                    </td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded-lg text-xs font-medium ${customer.level === 'A' ? 'bg-red-100 text-red-600' : (customer.level === 'B' ? 'bg-yellow-100 text-yellow-600' : 'bg-blue-100 text-blue-600')}">
                            ${customer.level}类
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded-lg text-xs font-medium ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <button onclick="editCustomer(${customer.id})" class="text-gray-400 hover:text-purple-600 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteCustomer(${customer.id})" class="text-gray-400 hover:text-red-600 transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                list.appendChild(tr);
            });
        }

        // 编辑客户
        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (!customer) return;
            
            currentEditId = id;
            currentEditType = 'customer';
            document.getElementById('customer-modal-title').textContent = '编辑客户';
            document.getElementById('customer-name').value = customer.name;
            document.getElementById('customer-company').value = customer.company;
            document.getElementById('customer-position').value = customer.position || '';
            document.getElementById('customer-phone').value = customer.phone;
            document.getElementById('customer-email').value = customer.email || '';
            document.getElementById('customer-level').value = customer.level;
            document.getElementById('customer-status').value = customer.status;
            document.getElementById('customer-notes').value = customer.notes || '';
            
            document.getElementById('customer-modal').classList.add('active');
        }

        // 删除客户
        function deleteCustomer(id) {
            if (confirm('确定要删除这个客户吗？')) {
                customers = customers.filter(c => c.id !== id);
                saveData();
                renderCustomers();
                renderDashboard();
            }
        }

        // 渲染商机列表
        function renderOpportunities() {
            const list = document.getElementById('opportunity-list');
            list.innerHTML = '';
            
            opportunities.forEach(opp => {
                const tr = document.createElement('tr');
                tr.className = 'table-row border-b border-gray-100';
                
                tr.innerHTML = `
                    <td class="p-4">
                        <div class="font-medium text-gray-800">${opp.customerName}</div>
                        <div class="text-xs text-gray-500">${opp.company}</div>
                    </td>
                    <td class="p-4 text-gray-600">${opp.product}</td>
                    <td class="p-4 font-medium text-gray-800">¥${parseFloat(opp.amount).toLocaleString()}</td>
                    <td class="p-4 text-gray-600">${opp.deliveryPeriod}天</td>
                    <td class="p-4">
                        <span class="px-2 py-1 rounded-lg text-xs font-medium ${opp.isDelivered ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}">
                            ${opp.isDelivered ? '已交付' : '进行中'}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <button onclick="editOpportunity(${opp.id})" class="text-gray-400 hover:text-purple-600 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteOpportunity(${opp.id})" class="text-gray-400 hover:text-red-600 transition-colors">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                list.appendChild(tr);
            });
        }
        
        // 渲染跟进记录
        function renderInteractions() {
            const list = document.getElementById('interaction-list');
            list.innerHTML = '';
            
            interactions.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex space-x-4 border-b border-gray-100 pb-4 last:border-0';
                
                let iconClass = '';
                switch(item.type) {
                    case 'phone': iconClass = 'fa-phone text-blue-500'; break;
                    case 'email': iconClass = 'fa-envelope text-yellow-500'; break;
                    case 'meeting': iconClass = 'fa-handshake text-purple-500'; break;
                    case 'wechat': iconClass = 'fa-comments text-green-500'; break;
                    default: iconClass = 'fa-circle text-gray-500';
                }
                
                div.innerHTML = `
                    <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-gray-800">${item.customerName}</h4>
                            <span class="text-xs text-gray-400">${item.date}</span>
                        </div>
                        <p class="text-gray-600 text-sm mt-1">${item.content}</p>
                        <div class="mt-2 flex items-center space-x-2 text-xs text-gray-400">
                            <span><i class="fas fa-user mr-1"></i>${item.createdBy}</span>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }
        
        // 更新商机统计数据（辅助函数，实际在renderDashboard中已处理，这里可保留作为特定更新）
        function updateOpportunityStats() {
            renderDashboard();
        }

        // 编辑商机
        function editOpportunity(id) {
            const opportunity = opportunities.find(o => o.id === id);
            if (!opportunity) return;
            
            currentEditId = id;
            currentEditType = 'opportunity';
            document.getElementById('opportunity-modal-title').textContent = '编辑商机';
            document.getElementById('opportunity-customer-name').value = opportunity.customerName;
            document.getElementById('opportunity-company').value = opportunity.company;
            document.getElementById('opportunity-email').value = opportunity.email;
            document.getElementById('opportunity-phone').value = opportunity.phone;
            document.getElementById('opportunity-product').value = opportunity.product;
            document.getElementById('opportunity-original-price').value = opportunity.originalPrice || opportunity.amount;
            document.getElementById('opportunity-discount').value = opportunity.discount || 0;
            document.getElementById('opportunity-amount').value = opportunity.amount;
            document.getElementById('opportunity-delivery-period').value = opportunity.deliveryPeriod;
            document.getElementById('opportunity-payment-period').value = opportunity.paymentPeriod;
            document.getElementById('opportunity-notes').value = opportunity.notes || '';
            
            // 设置交付状态
            const deliveryStatus = opportunity.isDelivered ? 'true' : 'false';
            document.querySelector(`input[name="delivery-status"][value="${deliveryStatus}"]`).checked = true;
            
            document.getElementById('opportunity-modal').classList.add('active');
        }

        // 删除商机
        function deleteOpportunity(id) {
            if (confirm('确定要删除这个商机吗？')) {
                opportunities = opportunities.filter(o => o.id !== id);
                saveData();
                renderOpportunities();
                updateOpportunityStats();
            }
        }
    </script>
</body>
</html>
```
